
map "http://worldhealthorganization.github.io/ddcc/StructureMap/shc-to-ddcc" = "SHCtoDDCC"


uses "http://hl7.org/fhir/uv/shc-vaccination/StructureDefinition/shc-vaccination-bundle-dm" alias SHCVaccinationBundleDM as source
uses "http://hl7.org/fhir/uv/shc-vaccination/StructureDefinition/shc-vaccination-bundle-ad" alias SHCVaccinationBundleAD as source
uses "http://hl7.org/fhir/uv/shc-vaccination/StructureDefinition/shc-patient-general-dm" alias patientDM as source
uses "http://hl7.org/fhir/uv/shc-vaccination/StructureDefinition/shc-patient-general-ad" alias patientAD as source
uses "http://hl7.org/fhir/uv/shc-vaccination/StructureDefinition/shc-patient-us-dm" alias patientUSDM as source
uses "http://hl7.org/fhir/uv/shc-vaccination/StructureDefinition/shc-patient-us-ad" alias patientUSAD as source
uses "http://hl7.org/fhir/uv/shc-vaccination/StructureDefinition/shc-vaccination-dm"  alias immunizationDM as source
uses "http://hl7.org/fhir/uv/shc-vaccination/StructureDefinition/shc-vaccination-ad" alias immunizationAD as source
uses "http://hl7.org/fhir/StructureDefinition/Bundle"  alias Bundle as target
uses "http://worldhealthorganization.github.io/ddcc/StructureDefinition/DDCCDocument"  alias DDCCDocument as target
uses "http://worldhealthorganization.github.io/ddcc/StructureDefinition/DDCCDocument"  alias DDCCDocument as target
uses "http://worldhealthorganization.github.io/ddcc/StructureDefinition/DDCCPatient"  alias DDCCPatient as target
uses "http://worldhealthorganization.github.io/ddcc/StructureDefinition/DDCCComposition" alias DDCCComposition as target
uses "http://worldhealthorganization.github.io/ddcc/StructureDefinition/DDCCOrganization" alias DDCCOrganization as target
uses 'http://worldhealthorganization.github.io/ddcc/StructureDefinition/DDCCCountryOfVaccination' alias DDCCCountryOfVaccination as target
uses "http://worldhealthorganization.github.io/ddcc/StructureDefinition/DDCCVaccineBrand" alias DDCCVaccineBrand as target
uses "http://worldhealthorganization.github.io/ddcc/StructureDefinition/DDCCImmunization" alias DDCCImmunization as target


group SHCtoDDCC (
    source shc : SHCVaccinationBundleDM
    target ddcc : Bundle
    ){

    shc.entry as patientEntrySHC then {
        patientEntrySHC.resource : Patient first as patientSHC then {
            shc.entry as immunizationEntrySHC then {
                immunizationEntrySHC.resource : Immunization as immunizationSHC then {
                    immunizationEntrySHC -> ddcc.type = 'collection' "Bundle type";
                    immunizationEntrySHC -> ddcc.entry as ddccEntry then {                    
                        immunizationSHC -> ddccEntry.resource = create('Bundle') as ddccdocument then {
                            immunizationSHC -> ddccdocument.type = 'document' "DDCC Document type";
                            immunizationSHC -> ddccdocument.entry as ddccDocumentEntry then {
                                immunizationSHC -> ddccDocumentEntry.resource = create('Immunization') as immunizationDDCC then SHCImmunizationtoDDCC(immunizationSHC,immunizationDDCC) "DDCC Document immunization resource";
                            } "DDCC Document immunization entry";
                        } "DDCC Document bundle";
                    } "DDCC Document entry";
                } "Is immunization entry";
            } "For each immunization entry";
        } "Is Patient entry";
    } "map patient";
}     

group SHCImmunizationtoDDCC(
      source immunization: immunizationDM,
      target immunizationDDCC : DDCCImmunization
      ) {

    immunization.status as status -> immunizationDDCC.status = status "Status";   

    immunization.coding as coding -> immunizationDDCC.coding = coding "Coding";
    immunization.occurrence as occurrenceDateTime -> immunizationDDCC.occurrence = occurrenceDateTime "Occurrence DateTime";

    immunization.manfacturer as manfacturer -> immunizationDDCC.manfacturer = manfacturer "Manufacturer";
    immunization.lotNumber as lotNumber -> immunizationDDCC.lotNumber = lotNumber "Lot Number";
}
